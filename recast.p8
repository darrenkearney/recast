pico-8 cartridge // http://www.pico-8.com
version 18
__lua__

#include includes/utilities.lua

-- globals
is_debug = true
pi = 3.1415
-- scenes
menu = {}
game = {}
over = {}

function _init()
   -- scene container
   scene = {}

   function scene:update()
   self.current:update()
   end

   function scene:draw()
   self.current.draw()
   end

   scene.current = menu
   scene.t = 1
   actor = {}
   actor.spr = 1

   -- collection of doodads
   doodads = {}

   add(doodads, new_doodad())

   music(1)
end

-- update calls
function menu.update()
   if scene.t % 30 == 0 then
      scene.current = game
   end
end

function game.update()

   for d in all(doodads) do
      d:update()
      if d.x > 128+d.size then
         del(doodads,d)
      end
   end

   if (scene.t % 30 == 0) then
      add(doodads, new_doodad())
   end

   if scene.t >= 30*20 then
      scene.current = over
   end
end

function over.update()

end

function update_doodads()
   for d in all(doodads) do
      d:update()
   end
end

-- draw calls
function menu.draw()
	cls(8)
	print_outline("recast",64-(flr(#"recast"*4/2)),60,7,0)
end

function game.draw()
	cls()
   print_outline("game",64-(flr(#"game"*4/2)),60,7,0)

   if is_debug then
      printh("doodads:"..#doodads)
      for d in all(doodads) do
         printh("d x:"..d.x.." y:"..d.y)
      end
   end
   draw_belt()
   draw_doodads()
end

function over.draw()
	cls()
	print_outline("game over",64-(#"game over"*4/2),60,7,0)
end

-- pico-8 api
function _update()
	scene:update()

   -- quickly change scenes in dev
	if btnp(3) and is_debug then
		if menu == scene.current then
			scene.current = game
		elseif game == scene.current then
			scene.current = over
		elseif over == scene.current then
			scene.current = menu
		end
	end

   scene.t += 1
end

function _draw()
	scene:draw()
end

-- visuals
function draw_belt()
   jostle = 0-- flr(rnd(1.01))*-1
   degrees = -0.05 * (scene.t%360)
   radius = 8
	circfill(8,108+jostle,radius,2)
	circfill(42,108+jostle,radius,2)
	circfill(80,108+jostle,radius,2)
	circfill(118,108+jostle,radius,2)
	rectfill(0,0,128,100,8)
	rect(-1,-1,128,100,0)
   line(8,108+jostle,8+flr((radius-1)*cos(degrees)),108+flr((radius-1)*sin(degrees))+jostle,8)
   line(42,108+jostle,42+flr((radius-1)*cos(degrees)),108+flr((radius-1)*sin(degrees))+jostle,8)
   line(80,108+jostle,80+flr((radius-1)*cos(degrees)),108+flr((radius-1)*sin(degrees))+jostle,8)
   line(118,108+jostle,118+flr((radius-1)*cos(degrees)),108+flr((radius-1)*sin(degrees))+jostle,8)
   line((scene.t%200-60),22+jostle,(scene.t%200-40),32,5)
   line(scene.t%200,94+jostle,(scene.t%200)-60,80,5)
end

function draw_doodads()
   for d in all(doodads) do
      d:draw()
   end
end

function new_doodad()
   local d = {}

   d.corners = ceil(rnd(4)+2)

   d.size = ceil(rnd(24)+12)

   d.r = flr(d.size/2)

   d.rotation = rnd(0.5)

   d.x = -d.size
   d.y = d.size + flr(rnd(108)-d.size)

   function d:update()
      self.x += 1
   end

   function d:draw()
      circ(self.x,self.y,self.r,9)

      local points = {}
      -- calc points
      for c=1,self.corners do
         -- pico-8 has a quirk with trig
         -- find the angle to this point on a circle
         local a = 1/self.corners
         a = a*c
         --rotation
         a = a+self.rotation
         a = a%1
         -- x = cx + r * cos(a)
         -- y = cy + r * sin(a)
         local x = self.x+self.r*cos(a)
         local y = self.y+self.r*sin(a)
         add(points,point(x,y))
         circ(x,y,3,7)
         pset(x,y,0)
      end
      for i,p in pairs(points) do
         if is_debug then printh("points:"..#points.." i:"..i.." p.x"..p.x.." p.y"..p.y) end
         if i < #points then
            line(points[i].x,points[i].y,points[i+1].x,points[i+1].y,7)
         else
            line(points[i].x,points[i].y,points[1].x,points[1].y,7)
         end
      end
   end

   return d
end

function point(x,y)
   local p = {}
   p.x = x
   p.y = y
   return p
end


__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000700000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000170000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000017000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000071000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000710000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000
__map__
0000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000400002b0602b060290702807025070240602306022050200401e0401b0401a04000040080400304001040000300003024030240401f0400304005040060500705007060080600807009070090700907000070
001005012b1502b140291502914029130291202615026140231502314023130231201f1501f1401f1301f1201f1501f1401d1501d1401f1001f1001a1501a1401715017140171301712013150131401313013120
001000002f1502f1402d1502d1402d1302d12029150291402615026140261302612023150231402313023120231502315021150211401f1001f1001d1501d1401a1501a1401a1301a12017150171401713017120
0110010107170071600715007140071300712007110131000b1700b1600b1500b1400b1300b1200b110231000e1700e1600e1500e1400e1300e1200e110000001317013160131501314013130131201311013100
0010000018150181401815018140000000000018150181401a1501a1401a1301a1201b1501b1401b1301b1201c1501c1401c1301c1201c1501c1401c1301c1201d1501d1401d1301d1201f1501f1401f1301f120
001000001c1501c1401c1501c14000000000001c1501c1401d1501d1401d1301d1201e1501e1401e1301e1201f1501f1401f1301f1201f1501f1401f1301f1202115021140211302112022150221402213022120
001000000c1500c1400c1500c14000000000000c1500c1400e1500e1400e1300e1200f1500f1400f1300f12010150101401013010120101501014010130101201115011140111301112013150131401313013120
0010000010150101401015010140000000000010150101401d1501d1401d1301d1201205012040120301202013150131401313013120131501314013130131201515015140151301512016150161401613016120
0010000013150171501c15013150171501c15013150171501f1501f140131501314015150151401715017140181501c1501f150181501c1501f150181501c1501f1501f1400c1500c14017150171401515015140
00100000171501a1501f150171501a1501f150171501a15000000000000000000000000000000000000000001f150000000000000000000000000000000000000000000000000000000000000000000000000000
00100000131501314013130131300e1200e1200e1100e1101317013160131501314013130131201311000000131501314013130131200c1500c1400c1300c1201315013140131301312000000000000000000000
00100000131501a1501f150131501a1501f150131501a1501315013140111501114010150101400e1500e1400c1500c1401015013150131401515013150131400c1500c1400c1300000018150181401813018120
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000024150241402413024120
00100000071500714007130071200b1500b1400b1300b12007150071400713007120000000000000000000000c1700c1600c1500c1400c1300c1200c010000000017000160001500014000130001200011000000
__music__
00 01020344
01 04050648
01 08090a46
02 0b0c0d44
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
1c 41424344
01 41424344
05 41424344
00 41424344
00 41424344
1c 41424344
01 41424344
05 41424344
00 41424344
00 41424344
1c 41424344
01 41424344
05 41424344

